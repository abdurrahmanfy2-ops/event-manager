<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gallery & Highlights - College Event Hub</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="homepage.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Gallery Upload Enhancements */
        .upload-zone {
            border: 2px dashed #667eea;
            border-radius: 15px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            margin: 1rem 0;
        }

        .upload-zone:hover, .upload-zone.dragover {
            background: rgba(102, 126, 234, 0.05);
            border-color: #667eea;
            transform: scale(1.02);
        }

        .upload-zone i {
            font-size: 3rem;
            color: #667eea;
            margin-bottom: 1rem;
        }

        .upload-progress {
            margin-top: 1rem;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s ease;
        }

        .file-preview {
            display: inline-block;
            margin: 0.5rem;
            text-align: center;
        }

        .file-preview img {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .file-preview .file-info {
            margin-top: 0.5rem;
            font-size: 0.8rem;
            color: #666;
        }

        .file-preview .remove-btn {
            background: #e53e3e;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            margin-top: 0.5rem;
            display: none;
        }

        .file-preview:hover .remove-btn {
            display: block;
        }

        .file-manager {
            margin-top: 2rem;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        .file-filters {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .file-filter {
            padding: 0.5rem 1rem;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-filter.active, .file-filter:hover {
            border-color: #667eea;
            color: #667eea;
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .gallery-item {
            position: relative;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .gallery-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
        }

        .gallery-item img {
            width: 100%;
            height: 250px;
            object-fit: cover;
            transition: all 0.3s ease;
        }

        .gallery-item:hover img {
            transform: scale(1.05);
        }

        .gallery-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
            color: white;
            padding: 1.5rem;
            transform: translateY(100%);
            transition: transform 0.3s ease;
        }

        .gallery-item:hover .gallery-overlay {
            transform: translateY(0);
        }

        .upload-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .stat-card {
            background: white;
            padding: 1rem;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        .batch-actions {
            display: flex;
            gap: 1rem;
            margin: 1rem 0;
        }

        .btn-secondary {
            padding: 0.8rem 1.5rem;
            border: 2px solid #e1e5e9;
            background: white;
            color: #666;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            border-color: #667eea;
            color: #667eea;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #667eea;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Modal for image preview */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            margin: auto;
            display: block;
            width: 80%;
            max-width: 800px;
            max-height: 80%;
            object-fit: contain;
        }

        .modal .close {
            position: absolute;
            top: 15px;
            right: 35px;
            color: #f1f1f1;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
        }

        .modal .close:hover {
            color: #bbb;
        }

        @media (max-width: 768px) {
            .gallery-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }

            .upload-zone {
                padding: 1.5rem;
            }
        }
    </style>
    <style>
        .gallery-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 3rem 0;
            margin-bottom: 2rem;
        }

        .gallery-filters {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-btn {
            background: #f1f5f9;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .filter-btn:hover,
        .filter-btn.active {
            background: #667eea;
            color: white;
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .gallery-item {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }

        .gallery-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .gallery-image {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .gallery-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .gallery-content {
            padding: 1.5rem;
        }

        .gallery-event {
            font-weight: 600;
            color: #64748b;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .gallery-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 1rem;
        }

        .gallery-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
        }

        .gallery-date {
            color: #64748b;
            font-size: 0.9rem;
        }

        .gallery-stats {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            color: #64748b;
            font-size: 0.8rem;
        }

        .highlights-section {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 2rem;
        }

        .highlight-card {
            display: flex;
            gap: 1.5rem;
            margin-bottom: 2rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid #e1e5e9;
        }

        .highlight-card:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .highlight-image {
            flex-shrink: 0;
            width: 120px;
            height: 120px;
            border-radius: 12px;
            background: linear-gradient(135deg, #10b981, #34d399);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .highlight-content h3 {
            margin: 0 0 0.5rem 0;
            font-size: 1.4rem;
        }

        .highlight-meta {
            display: flex;
            gap: 1rem;
            align-items: center;
            margin-bottom: 1rem;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            color: #64748b;
            font-size: 0.9rem;
        }

        .featured-section {
            background: linear-gradient(135deg, #f59e0b, #fbbf24);
            border-radius: 12px;
            padding: 2rem;
            color: white;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .featured-content h2 {
            margin: 0 0 1rem 0;
            font-size: 2rem;
        }

        .featured-image {
            width: 200px;
            height: 150px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .upload-section {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 2rem;
        }

        .upload-zone {
            border: 2px dashed #d1d5db;
            border-radius: 12px;
            padding: 3rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-zone:hover {
            border-color: #667eea;
            background: #f8fafc;
        }

        .upload-icon {
            font-size: 3rem;
            color: #667eea;
            margin-bottom: 1rem;
        }

        .upload-text h3 {
            margin: 0 0 0.5rem 0;
        }

        .share-section {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 2rem;
        }

        .share-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .share-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: transform 0.2s ease;
        }

        .share-btn:hover {
            transform: translateY(-2px);
        }

        .share-facebook { background: #1877f2; color: white; }
        .share-twitter { background: #1da1f2; color: white; }
        .share-instagram { background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888); color: white; }
        .share-whatsapp { background: #25d366; color: white; }

        @media (max-width: 768px) {
            .gallery-filters {
                flex-direction: column;
                align-items: stretch;
            }

            .filter-btn {
                flex: 1;
                text-align: center;
            }

            .highlight-card {
                flex-direction: column;
                text-align: center;
            }

            .featured-section {
                flex-direction: column;
                text-align: center;
            }

            .share-buttons {
                justify-content: center;
            }
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
        }

        .modal-content {
            position: relative;
            margin: auto;
            top: 10%;
            max-width: 90%;
            max-height: 80%;
            border-radius: 12px;
            overflow: hidden;
            animation: zoomIn 0.3s ease;
        }

        @keyframes zoomIn {
            from { transform: scale(0); }
            to { transform: scale(1); }
        }

        .close {
            position: absolute;
            top: 15px;
            right: 25px;
            color: white;
            font-size: 35px;
            font-weight: bold;
            cursor: pointer;
        }

        .modal-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .modal-info {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 1rem;
        }
    </style>
</head>
<body>
    <!-- Navigation Placeholder -->
    <div id="navigation-placeholder"></div>

    <header style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 3rem 0; text-align: center;">
        <h1><i class="fas fa-cloud-upload-alt"></i> Enhanced Cloud Gallery</h1>
        <p>Upload, manage, and share your event photos with cloud backup</p>
    </header>

    <div class="container" style="padding: 2rem;">
        <!-- Upload Stats -->
        <div class="upload-stats">
            <div class="stat-card">
                <div class="stat-value" id="totalFiles">0</div>
                <div class="stat-label">Total Files</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalSize">0 MB</div>
                <div class="stat-label">Storage Used</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="thisWeek">0</div>
                <div class="stat-label">This Week</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="storageQuota">2.1 GB</div>
                <div class="stat-label">Free Space</div>
            </div>
        </div>

        <!-- Enhanced Upload Zone -->
        <div class="upload-zone" id="uploadZone" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
            <i class="fas fa-cloud-upload-alt"></i>
            <h3>Drop Files Here or Click to Browse</h3>
            <p>Support for images, documents, and videos up to 10MB each</p>
            <input type="file" id="fileInput" multiple style="display: none;" onchange="handleFileSelection(this.files)">
            <button class="btn-primary" onclick="document.getElementById('fileInput').click()">
                Choose Files
            </button>
        </div>

        <!-- File Preview Area -->
        <div id="filePreviewArea" style="display: none; margin: 1rem 0;">
            <h3>Files Ready to Upload</h3>
            <div id="filePreviews" class="file-preview-container"></div>

            <div class="batch-actions">
                <button class="btn-secondary" onclick="clearAllFiles()">
                    <i class="fas fa-trash"></i> Clear All
                </button>
                <button class="btn-primary" id="uploadAllBtn" onclick="uploadAllFiles()">
                    <i class="fas fa-upload"></i> Upload All
                </button>
            </div>
        </div>

        <!-- Progress Monitor -->
        <div id="uploadProgress" style="display: none;">
            <h4>Upload Progress</h4>
            <div id="progressContainer"></div>
        </div>

        <!-- File Manager -->
        <div class="file-manager">
            <h3><i class="fas fa-folder-open"></i> File Manager</h3>

            <!-- Filters and Search -->
            <div class="file-filters">
                <button class="file-filter active" onclick="filterFiles('all')">All</button>
                <button class="file-filter" onclick="filterFiles('images')">Images</button>
                <button class="file-filter" onclick="filterFiles('documents')">Documents</button>
                <button class="file-filter" onclick="filterFiles('videos')">Videos</button>
                <input type="text" id="fileSearch" placeholder="Search files..." style="margin-left: auto; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
            </div>

            <!-- File List -->
            <div id="fileList" class="gallery-grid">
                <!-- Files will be loaded dynamically -->
                <div style="text-align: center; padding: 3rem; color: #666; grid-column: 1 / -1;">
                    <i class="fas fa-inbox fa-3x" style="margin-bottom: 1rem;"></i>
                    <h4>No files uploaded yet</h4>
                    <p>Upload some files to get started!</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Auth Utils and Cloud Storage -->
    <script src="auth-utils.js"></script>
    <script src="cloud-storage.js"></script>
    <script src="navigation.html"></script>

    <script>
        let selectedFiles = [];
        let uploading = false;

        // Load navigation
        document.addEventListener('DOMContentLoaded', function() {
            initializeGallery();
        });

        function initializeGallery() {
            // Load navigation
            if (typeof initializeNavigation === 'function') {
                initializeNavigation();
                initializeAuthNavigation();
            }

            // Load initial file list
            loadFileList();

            // Initialize upload zone interactions
            setupDragAndDrop();

            // Add file search functionality
            document.getElementById('fileSearch').addEventListener('input', filterFilesBySearch);
        }

        async function loadFileList() {
            if (!window.CloudStorage) return;

            try {
                const files = await window.CloudStorage.getFileList('images', 50);
                renderFileList(files);
                updateStats();
            } catch (error) {
                console.error('Failed to load file list:', error);
            }
        }

        function renderFileList(files) {
            const fileList = document.getElementById('fileList');

            if (!files || files.length === 0) return;

            const fileItems = files.map(file => `
                <div class="gallery-item" data-type="${file.type?.split('/')[0]}" data-name="${file.originalName?.toLowerCase() || ''}">
                    <img src="${file.url}" alt="${file.originalName}">
                    <div style="padding: 1rem;">
                        <h4>${file.originalName || 'Unnamed File'}</h4>
                        <p style="color: #666; font-size: 0.8rem;">
                            ${new Date(file.uploadedAt || file.uploaded_at).toLocaleDateString()}
                        </p>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 1rem;">
                            <small>${window.CloudStorage ? window.CloudStorage.formatFileSize(file.size) : file.size}</small>
                            <button class="btn-secondary" onclick="deleteFile('${file.path}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');

            fileList.innerHTML = fileItems;
        }

        function setupDragAndDrop() {
            const uploadZone = document.getElementById('uploadZone');

            uploadZone.addEventListener('click', () => {
                document.getElementById('fileInput').click();
            });
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.stopPropagation();
            e.currentTarget.classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            e.stopPropagation();
            e.currentTarget.classList.remove('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.stopPropagation();
            e.currentTarget.classList.remove('dragover');

            const files = e.dataTransfer.files;
            handleFileSelection(files);
        }

        function handleFileSelection(files) {
            selectedFiles = Array.from(files);
            renderFilePreviews();
        }

        function renderFilePreviews() {
            const previewArea = document.getElementById('filePreviewArea');
            const previews = document.getElementById('filePreviews');

            if (selectedFiles.length === 0) {
                previewArea.style.display = 'none';
                return;
            }

            previewArea.style.display = 'block';

            const previewItems = selectedFiles.map((file, index) => `
                <div class="file-preview">
                    ${file.type.startsWith('image/') ?
                        `<img src="${URL.createObjectURL(file)}" alt="${file.name}">` :
                        `<div style="width: 100px; height: 100px; background: #f0f0f0; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-file" style="color: #666; font-size: 2rem;"></i>
                        </div>`
                    }
                    <div class="file-info">
                        <div style="font-weight: bold; font-size: 0.9rem;">${file.name}</div>
                        <div style="color: #666; font-size: 0.8rem;">${window.CloudStorage ? window.CloudStorage.formatFileSize(file.size) : file.size}</div>
                    </div>
                    <button class="remove-btn" onclick="removeFile(${index})">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `).join('');

            previews.innerHTML = previewItems;
        }

        function removeFile(index) {
            selectedFiles.splice(index, 1);
            renderFilePreviews();
        }

        function clearAllFiles() {
            selectedFiles = [];
            renderFilePreviews();
        }

        async function uploadAllFiles() {
            if (selectedFiles.length === 0 || !window.CloudStorage) return;

            const uploadBtn = document.getElementById('uploadAllBtn');
            const originalText = uploadBtn.innerHTML;
            uploadBtn.innerHTML = '<div class="loading-spinner"></div> Uploading...';
            uploadBtn.disabled = true;

            try {
                // Set up progress tracking
                const progressContainer = document.getElementById('uploadProgress');
                const progressItems = selectedFiles.map((_, index) => `
                    <div style="margin: 0.5rem 0;">
                        <div>Uploading file ${index + 1}/${selectedFiles.length}...</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-${index}" style="width: 0%;">0%</div>
                        </div>
                    </div>
                `).join('');
                progressContainer.innerHTML = '<h4>Upload Progress</h4>' + progressItems;
                progressContainer.style.display = 'block';

                // Custom progress callbacks
                const originalProgress = window.CloudStorage.onProgress;
                window.CloudStorage.onProgress = function(progress, fileName) {
                    selectedFiles.forEach((file, index) => {
                        if (file.name === fileName) {
                            const progressFill = document.getElementById(`progress-${index}`);
                            if (progressFill) {
                                progressFill.style.width = `${progress}%`;
                                progressFill.textContent = `${Math.round(progress)}%`;
                            }
                        }
                    });
                    if (originalProgress) originalProgress(progress, fileName);
                };

                // Upload files
                const results = await window.CloudStorage.uploadFiles(selectedFiles, { category: 'gallery' });

                // Show results
                let successCount = results.results.length;
                let failedCount = results.errors.length;

                alert(`Upload completed!\n‚úÖ ${successCount} files uploaded successfully\n‚ùå ${failedCount} files failed`);

                if (successCount > 0) {
                    // Clear uploaded files and refresh list
                    selectedFiles = [];
                    renderFilePreviews();
                    setTimeout(() => loadFileList(), 1000);
                }

            } catch (error) {
                alert('Upload failed: ' + error.message);
                console.error('Upload error:', error);
            } finally {
                uploadBtn.innerHTML = originalText;
                uploadBtn.disabled = false;

                // Hide progress after a delay
                setTimeout(() => {
                    document.getElementById('uploadProgress').style.display = 'none';
                }, 3000);
            }
        }

        async function deleteFile(filePath) {
            if (!confirm('Are you sure you want to delete this file?')) return;

            try {
                const result = await window.CloudStorage.deleteFile(filePath);
                if (result.success) {
                    alert('File deleted successfully!');
                    loadFileList();
                } else {
                    alert('Failed to delete file');
                }
            } catch (error) {
                alert('Delete failed: ' + error.message);
            }
        }

        function filterFiles(category) {
            const filters = document.querySelectorAll('.file-filter');
            filters.forEach(f => f.classList.remove('active'));
            event.target.classList.add('active');

            const items = document.querySelectorAll('#fileList .gallery-item');

            items.forEach(item => {
                if (category === 'all') {
                    item.style.display = 'block';
                } else {
                    item.style.display = item.getAttribute('data-type') === category ? 'block' : 'none';
                }
            });
        }

        function filterFilesBySearch() {
            const searchTerm = document.getElementById('fileSearch').value.toLowerCase();
            const items = document.querySelectorAll('#fileList .gallery-item');

            items.forEach(item => {
                const fileName = item.getAttribute('data-name');
                item.style.display = fileName.includes(searchTerm) ? 'block' : 'none';
            });
        }

        async function updateStats() {
            try {
                const files = await window.CloudStorage.getFileList(null, 1000);
                const stats = {
                    totalFiles: files.length,
                    totalSize: files.reduce((sum, file) => sum + (file.size || 0), 0),
                    thisWeek: files.filter(file => {
                        const uploadDate = new Date(file.uploadedAt || file.uploaded_at);
                        const weekAgo = new Date();
                        weekAgo.setDate(weekAgo.getDate() - 7);
                        return uploadDate > weekAgo;
                    }).length
                };

                document.getElementById('totalFiles').textContent = stats.totalFiles;
                document.getElementById('totalSize').textContent = window.CloudStorage ?
                    window.CloudStorage.formatFileSize(stats.totalSize) : `${Math.round(stats.totalSize / 1024 / 1024)} MB`;
                document.getElementById('thisWeek').textContent = stats.thisWeek;
            } catch (error) {
                console.error('Failed to update stats:', error);
            }
        }

        // Global debug functions
        window.debugGallery = {
            loadFiles: loadFileList,
            uploadSingle: async (file) => {
                if (!window.CloudStorage) return console.error('Cloud storage not loaded');
                try {
                    const result = await window.CloudStorage.uploadFile(file, { category: 'debug' });
                    console.log('Single upload result:', result);
                } catch (error) {
                    console.error('Single upload failed:', error);
                }
            }
        };

        console.log('üñºÔ∏è Enhanced Gallery with Cloud Storage loaded');
        console.log('üí° Use window.debugGallery to test functions');
        console.log('üîß Use window.testAuth for authentication testing');
    </script>
</body>
</html></content>
